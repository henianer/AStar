window.__require=function t(e,o,n){function i(s,a){if(!o[s]){if(!e[s]){var l=s.split("/");if(l=l[l.length-1],!e[l]){var c="function"==typeof __require&&__require;if(!a&&c)return c(l,!0);if(r)return r(l,!0);throw new Error("Cannot find module '"+s+"'")}s=l}var h=o[s]={exports:{}};e[s][0].call(h.exports,function(t){return i(e[s][1][t]||t)},h,h.exports,t,e,o,n)}return o[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({AStarManager:[function(t,e,o){"use strict";cc._RF.push(e,"0e730gOObxJ/owk+e58TY+P","AStarManager");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var r=t("./AStarNode"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.row=0,e.column=0,e.nodes=[],e.openList=[],e.closeList=[],e}return i(e,t),e.prototype.initMapInfo=function(t,e){this.row=t,this.column=e,this.nodes=[];for(var o=0;o<this.row;o++)for(var n=0;n<this.column;n++){var i=new r.default(n,o,Math.random()<.2?r.EAStarNodeType.Wall:r.EAStarNodeType.Rode);this.nodes[o]||(this.nodes[o]=[]),this.nodes[o][n]=i}return this.nodes},e.prototype.pathfinding=function(t,e,o){if(t.x<0||t.x>=this.column||t.y<0||t.y>=this.row||e.x<0||e.x>=this.column||e.y<0||e.y>=this.row)return cc.warn("\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u70b9\u5728\u5730\u56fe\u5916"),[];var n=this.nodes[t.y][t.x],i=this.nodes[e.y][e.x];if(n.type===r.EAStarNodeType.Wall||i.type===r.EAStarNodeType.Wall)return cc.warn("\u5f00\u59cb\u6216\u8005\u7ed3\u675f\u70b9\u4e3a\u4e0d\u53ef\u901a\u8def\u70b9"),[];for(this.openList=[],this.closeList=[],n.parent=null,n.g=0,n.h=0,n.f=0,this.closeList.push(n);;){if(this.findAroundNodeToOpenList({x:n.x,y:n.y-1},1,n,i),this.findAroundNodeToOpenList({x:n.x,y:n.y+1},1,n,i),this.findAroundNodeToOpenList({x:n.x-1,y:n.y},1,n,i),this.findAroundNodeToOpenList({x:n.x+1,y:n.y},1,n,i),o&&(this.findAroundNodeToOpenList({x:n.x-1,y:n.y-1},Math.sqrt(2),n,i),this.findAroundNodeToOpenList({x:n.x-1,y:n.y+1},Math.sqrt(2),n,i),this.findAroundNodeToOpenList({x:n.x+1,y:n.y-1},Math.sqrt(2),n,i),this.findAroundNodeToOpenList({x:n.x+1,y:n.y+1},Math.sqrt(2),n,i)),0===this.openList.length)return[];if(this.openList.sort(this.sortOpenList),n=this.openList.shift(),this.closeList.push(n),n.x===i.x&&n.y===i.y){var s=[];for(s.push(i);null!=i.parent;)s.push(i.parent),i=i.parent;return s.reverse(),s}}},e.prototype.sortOpenList=function(t,e){return t.f>=e.f?1:-1},e.prototype.findAroundNodeToOpenList=function(t,e,o,n){if(!(t.x<0||t.x>=this.column||t.y<0||t.y>=this.row)){var i=this.nodes[t.y][t.x];null==i||i.type===r.EAStarNodeType.Wall||this.coordinateIndexOf(this.openList,t)>-1||this.coordinateIndexOf(this.closeList,t)>-1||(i.parent=o,i.g=o.g+e,i.h=Math.abs(n.x-i.x)+Math.abs(n.y-i.y),i.f=i.g+i.h,this.openList.push(i))}},e.prototype.coordinateIndexOf=function(t,e){for(var o=0;o<t.length;o++)if(t[o].x===e.x&&t[o].y===e.y)return o;return-1},e}(t("./Singleton").default);o.default=s,cc._RF.pop()},{"./AStarNode":"AStarNode","./Singleton":"Singleton"}],AStarNode:[function(t,e,o){"use strict";cc._RF.push(e,"f0f86kRQNRK4ae0YZUKKhI5","AStarNode"),Object.defineProperty(o,"__esModule",{value:!0}),o.EAStarNodeType=void 0,function(t){t[t.Rode=0]="Rode",t[t.Wall=1]="Wall"}(o.EAStarNodeType||(o.EAStarNodeType={}));o.default=function(t,e,o){this.x=-1,this.y=-1,this.f=0,this.g=0,this.h=0,this.parent=null,this.type=null,this.x=t,this.y=e,this.type=o},cc._RF.pop()},{}],AStarTest:[function(t,e,o){"use strict";cc._RF.push(e,"a2c33aCKotLdL9cu3jdZCDb","AStarTest");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function s(t){try{l(n.next(t))}catch(e){r(e)}}function a(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,a)}l((n=n.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(t){return function(e){return l([t,e])}}function l(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(a){r=[6,a],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var l=t("./AStarManager"),c=t("./AStarNode"),h=cc._decorator,u=h.ccclass,p=h.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.prefabCell=null,e.cells=null,e.btnPathfinding=null,e.toggleDirection=null,e.modifyData=!1,e.is8Direction=!1,e.cellWidth=100,e.cellHeight=100,e.row=5,e.column=5,e.startCoo={x:-1,y:-1},e.endCoo={x:-1,y:-1},e.cellArray=[],e.list=[],e.isPathfinding=!1,e}var o;return i(e,t),o=e,e.prototype.onLoad=function(){this.createCell(),this.touchStart()},e.prototype.start=function(){this.refreshToggle()},e.prototype.createCell=function(){l.default.getInstance(l.default).initMapInfo(this.row,this.column);for(var t=0;t<this.row;t++)for(var e=0;e<this.column;e++){var o=cc.instantiate(this.prefabCell);o.parent=this.cells,o.width=this.cellWidth,o.height=this.cellHeight;var n=-(this.column-1)/2*this.cellWidth+e*this.cellWidth,i=(this.row-1)/2*this.cellHeight-t*this.cellHeight;o.setPosition(n,i),o.getChildByName("Coordinate").getComponent(cc.Label).string=e+","+t,l.default.getInstance(l.default).nodes[t][e].type===c.EAStarNodeType.Wall&&(o.color=cc.Color.GRAY),this.cellArray[t]||(this.cellArray[t]=[]),this.cellArray[t].push(o)}},e.prototype.touchStart=function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_START,function(e){for(var o=0;o<t.cellArray.length;o++)for(var n=0;n<t.cellArray[o].length;n++)if(t.cellArray[o][n].getBoundingBoxToWorld().contains(e.getLocation())){if(l.default.getInstance(l.default).nodes[o][n].type===c.EAStarNodeType.Wall)return console.log("\u5899\u4e0d\u80fd\u4f5c\u4e3a\u8d77\u70b9\u6216\u8005\u7ec8\u70b9("+n+","+o+")");if(-1===t.startCoo.x&&-1===t.startCoo.y?(t.startCoo={x:n,y:o},t.cellArray[o][n].color=cc.Color.RED,console.log("\u8bbe\u7f6e\u8d77\u70b9("+n+","+o+")")):t.startCoo.x===n&&t.startCoo.y===o?(t.startCoo={x:-1,y:-1},t.cellArray[o][n].color=cc.Color.WHITE,console.log("\u53d6\u6d88\u8d77\u70b9("+n+","+o+")")):-1===t.endCoo.x&&-1===t.endCoo.y?(t.endCoo={x:n,y:o},t.cellArray[o][n].color=cc.Color.BLUE,console.log("\u8bbe\u7f6e\u7ec8\u70b9("+n+","+o+")")):t.endCoo.x===n&&t.endCoo.y===o&&(t.endCoo={x:-1,y:-1},t.cellArray[o][n].color=cc.Color.WHITE,console.log("\u53d6\u6d88\u7ec8\u70b9("+n+","+o+")")),t.list.length>0&&!t.isPathfinding){t.startCoo={x:-1,y:-1},t.endCoo={x:-1,y:-1};for(var i=0;i<t.list.length;i++)t.cellArray[t.list[i].y][t.list[i].x].color=cc.Color.WHITE;t.list=[]}t.startCoo.x>-1&&t.startCoo.y>-1&&t.endCoo.x>-1&&t.endCoo.y>-1&&!t.isPathfinding?t.btnPathfinding.node.active=!0:t.btnPathfinding.node.active=!1;break}},this)},e.prototype.onclickPathfinding=function(){return s(this,void 0,void 0,function(){var t;return a(this,function(e){switch(e.label){case 0:if(this.isPathfinding=!0,this.btnPathfinding.node.active=!1,this.list=l.default.getInstance(l.default).pathfinding(this.startCoo,this.endCoo,this.is8Direction),0===this.list.length)return this.isPathfinding=!1,this.cellArray[this.startCoo.y][this.startCoo.x].color=cc.Color.WHITE,this.cellArray[this.endCoo.y][this.endCoo.x].color=cc.Color.WHITE,this.startCoo={x:-1,y:-1},this.endCoo={x:-1,y:-1},[2,console.log("\u65e0\u8def\u5f84\u53ef\u5230\u8fbe")];t=0,e.label=1;case 1:return t<this.list.length?[4,this.sleep(.1)]:[3,4];case 2:e.sent(),this.cellArray[this.list[t].y][this.list[t].x].color=cc.Color.GREEN,t===this.list.length-1&&(this.isPathfinding=!1),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.refreshToggle=function(){this.toggleDirection.isChecked=this.node.getComponent(o).is8Direction},e.prototype.onclickToggle=function(){this.node.getComponent(o).is8Direction=this.toggleDirection.isChecked},e.prototype.sleep=function(t,e){return new Promise(function(o){e?e.scheduleOnce(function(){o(t)},t):setTimeout(function(){o(t)},1e3*t)})},r([p({type:cc.Prefab,displayName:"\u5355\u5143\u683c"})],e.prototype,"prefabCell",void 0),r([p({type:cc.Node,displayName:"\u5355\u5143\u683c"})],e.prototype,"cells",void 0),r([p({type:cc.Button,displayName:"\u5bfb\u8def\u6309\u94ae"})],e.prototype,"btnPathfinding",void 0),r([p({type:cc.Toggle,displayName:"8\u65b9\u5411"})],e.prototype,"toggleDirection",void 0),r([p({displayName:"\u4fee\u6539\u6570\u503c",tooltip:"\u9ed8\u8ba4\u5bbd\u9ad8100*100,\u9ed8\u8ba4\u884c\u52175*5,\u9ed8\u8ba44\u65b9\u5411"})],e.prototype,"modifyData",void 0),r([p({displayName:"\u662f\u54268\u65b9\u5411",visible:function(){return this.modifyData}})],e.prototype,"is8Direction",void 0),r([p({displayName:"\u5355\u5143\u683c_\u5bbd",visible:function(){return this.modifyData}})],e.prototype,"cellWidth",void 0),r([p({displayName:"\u5355\u5143\u683c_\u9ad8",visible:function(){return this.modifyData}})],e.prototype,"cellHeight",void 0),r([p({displayName:"\u884c",visible:function(){return this.modifyData}})],e.prototype,"row",void 0),r([p({displayName:"\u5217",visible:function(){return this.modifyData}})],e.prototype,"column",void 0),o=r([u],e)}(cc.Component);o.default=f,cc._RF.pop()},{"./AStarManager":"AStarManager","./AStarNode":"AStarNode"}],Singleton:[function(t,e,o){"use strict";cc._RF.push(e,"aed3e6fE3lIPLVfXGg87hIJ","Singleton"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.getInstance=function(t){return this.instance||(this.instance=new t),this.instance},t.instance=null,t}();o.default=n,cc._RF.pop()},{}]},{},["AStarManager","AStarNode","AStarTest","Singleton"]);